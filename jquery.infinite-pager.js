// Generated by CoffeeScript 1.3.3
(function() {
  var $;

  $ = jQuery;

  $.fn.infinitePager = function(options) {
    var $context, currentlyLoading, nearBottomOfPage, paginationPossible;
    $context = $(this);
    currentlyLoading = false;
    options = $.extend({}, $.infinitePager.defaults, options);
    nearBottomOfPage = function() {
      return $(window).scrollTop() > $(document).height() - $(window).height() - options.bottomOffset;
    };
    paginationPossible = function() {
      var $list;
      $list = $context.find(options.listSelector);
      return $list.length && $list.find('.pagination').length;
    };
    return $(window).scroll(function() {
      var $list, $pagination;
      if (!currentlyLoading && nearBottomOfPage() && paginationPossible()) {
        $list = $context.find(options.listSelector);
        $pagination = $list.find(options.pagerSelector);
        return $pagination.find(options.linkSelector).last().each(function() {
          var $next;
          $next = $(this);
          $list.toggleClass(options.loadingClass, currentlyLoading = true);
          return $.get($next.attr('href'), function(data) {
            var $loadedList;
            $list.toggleClass(options.loadingClass, currentlyLoading = false);
            $loadedList = $(data).find(options.listSelector);
            if ($loadedList.length) {
              options.success($loadedList);
              return $pagination.replaceWith($loadedList.children());
            }
          });
        });
      }
    });
  };

  $.infinitePager = function(options) {
    return $(document).infinitePager(options);
  };

  $.infinitePager.defaults = {
    bottomOffset: 200,
    listSelector: '[rel=paginates]',
    pagerSelector: '.pagination',
    linkSelector: 'a[rel=next]',
    loadingClass: 'loading',
    success: function($context) {}
  };

}).call(this);
